<!DOCTYPE html>
<html>
<head>
<title>XRX++ Unit Tests - xrx.node.Element</title>
<script src='../../../lib/closure-library/closure/goog/base.js'></script>
<script src='../../deps.js'></script>
<script type="text/javascript">
  goog.require('goog.dom');
  goog.require('goog.testing.jsunit');
  goog.require('xrx.instance');
  goog.require('xrx.label');
  goog.require('xrx.node.Element');
  goog.require('xrx.node.ElementS');
  goog.require('xrx.node.ElementB');
  goog.require('xrx.xpath');
  goog.require('xrx.xpath.NameTest');
  goog.require('xrx.xpath.KindTest');
</script>
</head>
<body>

<div id="i1" class="xrx-instance">&lt;x xmlns="http://example.org/x"&gt;&lt;y:y xmlns:y="http://example.org/y"/&gt;&lt;z/&gt;&lt;/x&gt;</div>

<div id="i2" class="xrx-instance">&lt;a&gt;&lt;b&gt;&lt;c/&gt;&lt;/b&gt;&lt;d/&gt;&lt;e/&gt;&lt;/a&gt;</div>

<script type="text/javascript">

function test01nameFunctions() {
  var instance = new xrx.instance(goog.dom.getElement('i1'));
  var elementB1 = new xrx.node.ElementB(instance, 1);
  var elementB2 = new xrx.node.ElementB(instance, 2);

  var nameB1 = elementB1.getName();
  var nameB2 = elementB2.getName();

  var localNameB1 = xrx.node.Element.getNameLocal(nameB1);
  var localNameB2 = xrx.node.Element.getNameLocal(nameB2);
  
  var prefixB1 = xrx.node.Element.getNamePrefix(nameB1);
  var prefixB2 = xrx.node.Element.getNamePrefix(nameB2);
  
  var namespaceUriB1 = elementB1.getNamespaceUri(prefixB1);
  var namespaceUriB2 = elementB2.getNamespaceUri(prefixB2);
  
  var expandedNameB1 = xrx.node.Element.getNameExpanded(namespaceUriB1, localNameB1);
  var expandedNameB2 = xrx.node.Element.getNameExpanded(namespaceUriB2, localNameB2);

  assertEquals(nameB1, 'y:y');
  assertEquals(nameB2, 'z');
  assertEquals(localNameB1, 'y');
  assertEquals(localNameB2, 'z');
  assertEquals(prefixB1, 'xmlns:y');
  assertEquals(prefixB2, 'xmlns');
  assertEquals(namespaceUriB1, 'http://example.org/y');
  assertEquals(namespaceUriB2, 'http://example.org/x');
  assertEquals(expandedNameB1, 'http://example.org/y#y');
  assertEquals(expandedNameB2, 'http://example.org/x#z');
};

function test02identityFunctions() {
  
};

/**
 * Node Functions
 */
var xml = '<a>1<b>2</b>3<c/>4<d>t<e type="attrValue">5</e>6</d><d id="test"/></a>';
var element = goog.dom.createElement('div');
goog.dom.setTextContent(element, xml);
var instance = new xrx.instance(element);

function test03nodeAncestor() {
  var e = new xrx.node.ElementB(instance, 5);

  var ancestorNode = e.getNodeAncestor(new xrx.xpath.KindTest('node'));
  var ancestorElement = e.getNodeAncestor(new xrx.xpath.NameTest('*'));
  var ancestorText = e.getNodeAncestor(new xrx.xpath.KindTest('text'));
  var ancestorAttribute = e.getNodeAncestor(new xrx.xpath.NameTest('@*'));

  assertEquals(3, ancestorNode.getLength());
  assertEquals(2, ancestorElement.getLength());
  assertEquals(0, ancestorText.getLength());
  assertEquals(0, ancestorAttribute.getLength());
};

function test04nodeChild() {
  var a = new xrx.node.ElementB(instance, 0);

  var childNode = a.getNodeChild(new xrx.xpath.KindTest('node'));
  var childElement = a.getNodeChild(new xrx.xpath.NameTest('*'));
  var childText = a.getNodeChild(new xrx.xpath.KindTest('text'));
  var childAttribute = a.getNodeChild(new xrx.xpath.NameTest('@*'));

  assertEquals(7, childNode.getLength());
  assertEquals(4, childElement.getLength());
  assertEquals(3, childText.getLength());
  assertEquals(0, childAttribute.getLength()); 
};

function test05nodeDescendant() {
  var a = new xrx.node.ElementB(instance, 0);

  var descendantNode = a.getNodeDescendant(new xrx.xpath.KindTest('node'));
  var descendantElement = a.getNodeDescendant(new xrx.xpath.NameTest('*'));
  var descendantText = a.getNodeDescendant(new xrx.xpath.KindTest('text'));
  var descendantAttribute = a.getNodeDescendant(new xrx.xpath.NameTest('@*'));

  assertEquals(12, descendantNode.getLength());
  assertEquals(5, descendantElement.getLength());
  assertEquals(7, descendantText.getLength());
  assertEquals(0, descendantAttribute.getLength()); 
};

function test05nodeFollowing() {
  var a = new xrx.node.ElementB(instance, 0);

  var followingNode = a.getNodeFollowing(new xrx.xpath.KindTest('node'));
  var followingElement = a.getNodeFollowing(new xrx.xpath.NameTest('*'));
  var followingText = a.getNodeFollowing(new xrx.xpath.KindTest('text'));
  var followingAttribute = a.getNodeFollowing(new xrx.xpath.NameTest('@*'));

  assertEquals(12, followingNode.getLength());
  assertEquals(5, followingElement.getLength());
  assertEquals(7, followingText.getLength());
  assertEquals(0, followingAttribute.getLength()); 
};

</script>
</body>
</html>

