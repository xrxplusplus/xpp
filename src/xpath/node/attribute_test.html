<!DOCTYPE html>
<html>
<head>
<title>XRX++ Unit Tests - xrx.node.Attribute, xrx.node.AttributeS, xrx.node.AttributeB</title>
<script src='../../../lib/closure-library/closure/goog/base.js'></script>
<script src='../../deps.js'></script>
<script type="text/javascript">
  goog.require('goog.dom');
  goog.require('goog.testing.jsunit');
  goog.require('xrx.instance');
  goog.require('xrx.node.Attribute');
  goog.require('xrx.node.AttributeS');
  goog.require('xrx.node.AttributeB');
  goog.require('xrx.node.Element');
  goog.require('xrx.node.ElementS');
  goog.require('xrx.node.ElementB');
  goog.require('xrx.xpath');
  goog.require('xrx.xpath.NameTest');
  goog.require('xrx.xpath.KindTest');
</script>
</head>
<body>

<script type="text/javascript">

function test01basic() {
  var xml = '<a xmlns="http://example.org/y" attr1="v" attr2="v"/>';
  //         0         10        20          32

  var element = goog.dom.createElement('div');
  goog.dom.setTextContent(element, xml);
  var instance = new xrx.instance(element);

  var e = new xrx.node.ElementB(instance, 0);
  var a = new xrx.node.AttributeB(2, e);

  assertEquals(32, a.getOffset());
  assertEquals(9, a.getLength());
};



function test01nameFunctions() {
  var xml = '<x:x xmlns:x="http://example.org/x"><y:y xmlns:y="http://example.org/y" y:a=""/><z x:b=""/></x:x>';
  var element = goog.dom.createElement('div');
  goog.dom.setTextContent(element, xml);
  var instance = new xrx.instance(element);

  var e1 = new xrx.node.ElementB(instance, 1);
  var e2 = new xrx.node.ElementB(instance, 2);

  var a1 = new xrx.node.AttributeB(2, e1);
  var a2 = new xrx.node.AttributeB(1, e2);

  assertEquals('y:a', a1.getName());
  assertEquals('x:b', a2.getName());
};

function test02identityFunctions() {
  var xml = '<a a="v">1<b/></a>';
  var element = goog.dom.createElement('div');
  goog.dom.setTextContent(element, xml);
  var instance = new xrx.instance(element);

  var e1 = new xrx.node.ElementB(instance, 0);
  var a = new xrx.node.AttributeB(1, e1);
  var e2 = new xrx.node.ElementB(instance, 1);

  assertEquals(false, e2.isSameAs(a));
  assertEquals(true, e2.isAfter(a));
  assertEquals(true, e1.isBefore(a));
  assertEquals(true, a.isAttributeOf(e1));
};

function test03contentFunctions() {
  var xml = '<a attr1="v1" attr2="v2"/>';
  var element = goog.dom.createElement('div');
  goog.dom.setTextContent(element, xml);
  var instance = new xrx.instance(element);

  var e = new xrx.node.ElementB(instance, 0);
  var a1 = new xrx.node.AttributeB(1, e);
  var a2 = new xrx.node.AttributeB(2, e);

  assertEquals('attr1="v1"', a1.getXml());
  assertEquals('attr2="v2"', a2.getXml());
  assertEquals('v1', a1.getStringValue());
  assertEquals('v2', a2.getStringValue());
};

function axisTest(key, func, expected) {
  var xml = '<a>1<b>2</b>3<c/>4<d>t<e type="attrValue">5</e>6</d><d id="test"/></a>';
  var element = goog.dom.createElement('div');
  goog.dom.setTextContent(element, xml);
  var instance = new xrx.instance(element);
  var e = new xrx.node.ElementB(instance, key);
  var a = new xrx.node.AttributeB(1, e);
  var test = {
    node: a[func](new xrx.xpath.KindTest('node')),
    element: a[func](new xrx.xpath.NameTest('*')),
    text: a[func](new xrx.xpath.KindTest('text')),
    attribute: a[func](new xrx.xpath.NameTest('@*'))
  }

  assertEquals(expected.node, test.node.getLength());
  assertEquals(expected.element, test.element.getLength());
  assertEquals(expected.text, test.text.getLength());
  assertEquals(expected.attribute, test.attribute.getLength());
};


function test04nodeFunctions() {

  // ancestor
  //axisTest(5, 'getNodeAncestor', { node: 3, element: 2, text: 0, attribute: 0 });

  // child
  axisTest(5, 'getNodeChild', { node: 0, element: 0, text: 0, attribute: 0 });

  // descendant
  axisTest(5, 'getNodeDescendant', { node: 0, element: 0, text: 0, attribute: 0 });

  // following
  axisTest(5, 'getNodeFollowing', { node: 0, element: 0, text: 0, attribute: 0 });

  // following sibling
  axisTest(5, 'getNodeFollowingSibling', { node: 0, element: 0, text: 0, attribute: 0 });

  // parent
  axisTest(5, 'getNodeParent', { node: 1, element: 1, text: 0, attribute: 0 });

  // preceding
  axisTest(5, 'getNodePreceding', { node: 0, element: 0, text: 0, attribute: 0 });

  // preceding sibling
  axisTest(5, 'getNodePrecedingSibling', { node: 0, element: 0, text: 0, attribute: 0 });

};

function test05attributeFunction() {
  var xml = '<a><b xmlns="http://example.org" attr1="v1" attr2="v2"/></a>';
  var element = goog.dom.createElement('div');
  goog.dom.setTextContent(element, xml);
  var instance = new xrx.instance(element);

  var e0 = new xrx.node.ElementB(instance, 0);
  var e1 = new xrx.node.ElementB(instance, 1);

  assertEquals(0, e0.getNodeAttribute(new xrx.xpath.NameTest('@*')).getLength());
  assertEquals(2, e1.getNodeAttribute(new xrx.xpath.NameTest('@*')).getLength());
};

</script>
</body>
</html>

